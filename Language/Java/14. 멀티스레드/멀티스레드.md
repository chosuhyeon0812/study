# 1. 멀티스레드(Multi thread)

## 1. 멀티 스레드 개념

- 프로세스(process) : 운영체제가 실행 중인 프로그램
- 멀티태스킹(multi tasking) : 두 가지 이상의 작업을 동시에 처리하는 것
- 하나의 프로세스가 두 가지 이사의 작업을 처리할 수 있는 이유는 멀티 스레드(multi thread)가 있기 때문이다
- 스헤드(thread)는 코드의 실행 흐름을 말하는데, 멀티스레드는 프로세스 내에 스레드가 두개가 있어 두개의 코드 실행 흐름이 생긴다는 의미
- 멀티 프로세스들은 서로 독립적이어서 하나의 프로세스에서 오류가 발생해도 다른 프로세스에게 영향을 미치지는 않지만 멀티 스레ㄷ는 프로세스 내부에서 생성되기 때문에 하나의 스레드가 예외를 발생시키면 종료되므로 다른 스레드에게 영향을 미친다(멀티 스레드를 사용할 경우에는 예외 처리에 신중히.. 그래서 써본적이 없는듯)
- 사용 용도

    1. 데이터를 분할해서 병렬로 처리하는 곳
    2. 안드로이드 앱에서 네트워크 통신을 하기 위해 사용
    3. 다수의 클라이언트 요청을 처리하는 서버를 개발

## 2. 메인 스레드

- 모든 자바 프로그램은 메인 스레드가 main() 메소드를 실행하면서 시작
- 메인스레드는 필요에 따라 추가 작업 스레드들을 만들어 실행
- 싱글 스레드에서는 메인 스레드가 종료되면 프로세스도 종료되지만, 멀티 스레드에서는 실행 중인 스레드가 하나라도 있다면 프로세스는 종료되지 않는다

## 3. 작업 스레드 생성과 실행

- 멀티 스레드로 실행하는 프로그램을 개발하려면 먼저 몇 개의 작업을 병렬로 실행할지 결정하고 각 작업별로 스레드를 생성해야한다
- 자바는 작업 스레드도 객체로 관리하므로 클래스가 필요하다
- Thread 클래스로 직접 객체를 생성해도 되지만, 하위 클래스를 만들어 생성할 수도 있다

    1. Thread 클래스로 직접 생성

        ``` java
        // Thread 클래스로부터 작업 스레드 객체를 직접 생성하려면 Runnable 구현 객체를 매개값으로 갖는 생성자를 호출하면 된다
        Thread thread = new Thread(Runnable target);    

        // Runnable은 스레드가 작업을 실행할 때 사용하는 인터페이스
        // run() 메소드가 정의되어 있는데, 구현 클래스는 run()을 재정의해서 스레드가 실행할 코드를 가지고 있어야 함
        class Task implements Runnable {
            @Override
            public void run() {
                // 스레드가 실행할 코드
            }
        }

        // Runnable 구현 클래스는 작업 내용을 정의한 것이므로, 스레드에게 전달해야 한다
        Runnable task = new Task();
        Thread thread = new Thread(task);

        // 명시적인 Runnable 구현 클래스를 작성하지 않고 Thread 생성자를 호출할 때 Runnable 익명구현 객체를 매개값을 사용(이 방법이 더 많이 쓰임)
        Thread thread = new thread(new Runnable() {
            @Override
            public void run() {
                // 스레드가 실행할 코드드
            }
        })

        // 스레드가 실행하기 위해서는 start() 메소드 호출
        thread.start();
        ```

    2. 자식 클래스로 생성

        ``` java
        // 작업 스레드의 객체를 생성하는 또 다른 방법은 Thread의 자식 객체로 만드는 것
        public class WorkerThread extends Thread {
            @Override
            public void run() {
                // 스레드가 실행할 코드
            }
        }

        // 스레드 객체 생성
        Thread thread = new WorkerThread();

        // 스레드 실행
        thread.start();

        // Thread 익명 자식 객체
        Thread thread = new Thread() {
            @Override
            public void run() {
                // 스레드가 실행할 코드
            }
        };
        thread.start();
        
        ```

## 4. 스레드 동기화

- 스레드가 사용 중인 객체를 다른 스레드가 변경할 수 없도록 하려면 스레드 작업이 끝날 때까지 객체에 잠금을 걸면되는데, 이를 위해 자바는 동기화(synchronized) 메소드 블록을 제공한다
- 메소드 동기화 블록이 여러 개가 있다면 스레드가 이들 중 하나를 실행할 때 다른 스레드는 해당 메소드는 물론이고 다른 동기화 메소드 및 블록도 실행할 수 있다
- 동기화 메소드를 선언하는 방법은 다음과 같이 synchronized 키워들르 붙이면 된다 / 이 키워드는 인스턴스와 정적 메소드 어디든 붙일 수 있다

    ``` java 
    // 동기화 메소드 선언
    public synchronized void method() {
        // 단 하나의 스레드만 실행하는 영역
    }

    // 메소드 전체가 아닌 일부 영역을 실행할 때만 객체 잠금을 걸고 싶다면..
    public void method() {
        // 여러 스레드가 실행할 수 있는 영역
        synchronized(공유객체) {
            // 단 하나의 스레드만 실행하는 영역
        }
        // 여러 스레드가 실행할 수 있는 영역
    }
    ```

